{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="medical-analysis-platform/prisma/migrations/add_user_roles.sql">\n-- Add role column to User table if it doesn\'t exist\nDO $$ \nBEGIN\n  IF NOT EXISTS (\n    SELECT 1 FROM information_schema.columns \n    WHERE table_name = \'User\' AND column_name = \'role\'\n  ) THEN\n    ALTER TABLE "User" ADD COLUMN "role" TEXT NOT NULL DEFAULT \'PATIENT\';\n  END IF;\nEND $$;\n\n-- Create index on role for faster queries\nCREATE INDEX IF NOT EXISTS "User_role_idx" ON "User"("role");\n\n-- Update existing users to have PATIENT role if null\nUPDATE "User" SET "role" = \'PATIENT\' WHERE "role" IS NULL;\n\n-- Add AccessLog table for audit logging\nCREATE TABLE IF NOT EXISTS "AccessLog" (\n  "id" TEXT NOT NULL PRIMARY KEY,\n  "userId" TEXT NOT NULL,\n  "action" TEXT NOT NULL,\n  "resourceType" TEXT NOT NULL,\n  "resourceId" TEXT,\n  "allowed" BOOLEAN NOT NULL,\n  "reason" TEXT,\n  "ipAddress" TEXT,\n  "userAgent" TEXT,\n  "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  CONSTRAINT "AccessLog_userId_fkey" FOREIGN KEY ("userId") REFERENCES "User"("id") ON DELETE CASCADE\n);\n\n-- Create indexes for AccessLog\nCREATE INDEX IF NOT EXISTS "AccessLog_userId_idx" ON "AccessLog"("userId");\nCREATE INDEX IF NOT EXISTS "AccessLog_timestamp_idx" ON "AccessLog"("timestamp");\nCREATE INDEX IF NOT EXISTS "AccessLog_allowed_idx" ON "AccessLog"("allowed");\nCREATE INDEX IF NOT EXISTS "AccessLog_resourceType_idx" ON "AccessLog"("resourceType");\n\n-- Add comment explaining the role system\nCOMMENT ON COLUMN "User"."role" IS \'User role: OWNER, ADMIN, DOCTOR, PATIENT, SUPPORT, ANALYST\';\n</create-file>\n</function_calls>'}