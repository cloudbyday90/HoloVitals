{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="medical-analysis-platform/app/api/ehr/sync/route.ts">\n/**\n * EHR Sync API\n * \n * POST /api/ehr/sync - Trigger manual sync\n * GET /api/ehr/sync - Get sync status\n */\n\nimport { NextRequest, NextResponse } from \'next/server\';\nimport { EHRSyncService } from \'@/lib/services/EHRSyncService\';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const {\n      connectionId,\n      syncType = \'incremental\',\n      resourceTypes,\n      downloadDocuments = true,\n    } = body;\n\n    if (!connectionId) {\n      return NextResponse.json(\n        { error: \'Missing required field: connectionId\' },\n        { status: 400 }\n      );\n    }\n\n    // Start sync\n    const syncId = await EHRSyncService.startSync({\n      connectionId,\n      syncType,\n      resourceTypes,\n      downloadDocuments,\n    });\n\n    return NextResponse.json({\n      success: true,\n      syncId,\n      message: \'Sync started successfully\',\n    });\n  } catch (error: any) {\n    console.error(\'Start sync error:\', error);\n    return NextResponse.json(\n      { error: error.message || \'Failed to start sync\' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const syncId = searchParams.get(\'syncId\');\n    const connectionId = searchParams.get(\'connectionId\');\n\n    if (syncId) {\n      // Get specific sync status\n      const sync = await EHRSyncService.getSyncStatus(syncId);\n      \n      if (!sync) {\n        return NextResponse.json(\n          { error: \'Sync not found\' },\n          { status: 404 }\n        );\n      }\n\n      return NextResponse.json({\n        success: true,\n        sync,\n      });\n    } else if (connectionId) {\n      // Get sync history for connection\n      const history = await EHRSyncService.getSyncHistory(connectionId);\n\n      return NextResponse.json({\n        success: true,\n        history,\n        total: history.length,\n      });\n    } else {\n      return NextResponse.json(\n        { error: \'Missing syncId or connectionId parameter\' },\n        { status: 400 }\n      );\n    }\n  } catch (error: any) {\n    console.error(\'Get sync status error:\', error);\n    return NextResponse.json(\n      { error: error.message || \'Failed to get sync status\' },\n      { status: 500 }\n    );\n  }\n}\n</create-file>\n</function_calls>'}