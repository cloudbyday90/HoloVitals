{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="prisma/schema-medical-standardization.prisma">\n// Medical Standardization Repository Schema\n// Add this to your main schema.prisma file\n\n// LOINC Code Categories\nenum LOINCCategory {\n  LABORATORY\n  CLINICAL\n  SURVEY\n  CLAIMS\n  DOCUMENT\n  RADIOLOGY\n}\n\n// Component Types\nenum ComponentType {\n  CHEMISTRY\n  HEMATOLOGY\n  MICROBIOLOGY\n  IMMUNOLOGY\n  TOXICOLOGY\n  GENETICS\n  PATHOLOGY\n  VITAL_SIGNS\n  OTHER\n}\n\n// Unit Systems\nenum UnitSystem {\n  UCUM  // Unified Code for Units of Measure\n  SI    // International System of Units\n  CONVENTIONAL\n}\n\n// Reference Range Types\nenum ReferenceRangeType {\n  NORMAL\n  CRITICAL_LOW\n  CRITICAL_HIGH\n  THERAPEUTIC\n  TOXIC\n}\n\n// LOINC Code Model\nmodel LOINCCode {\n  id              String          @id @default(cuid())\n  loincNumber     String          @unique // e.g., "2345-7"\n  \n  // LOINC Components\n  component       String          // e.g., "Glucose"\n  property        String          // e.g., "MCnc" (Mass Concentration)\n  timeAspect      String          // e.g., "Pt" (Point in time)\n  system          String          // e.g., "Ser/Plas" (Serum or Plasma)\n  scale           String          // e.g., "Qn" (Quantitative)\n  method          String?         // e.g., "Enzymatic"\n  \n  // Classification\n  category        LOINCCategory\n  componentType   ComponentType\n  \n  // Display Names\n  commonName      String          // Most common name\n  shortName       String          // Abbreviated name\n  longName        String          // Full descriptive name\n  relatedNames    String[]        // Alternative names\n  \n  // Status\n  status          String          @default("ACTIVE") // ACTIVE, DEPRECATED, TRIAL\n  version         String          @default("2.76")\n  effectiveDate   DateTime        @default(now())\n  \n  // Relationships\n  units           LOINCUnit[]\n  referenceRanges ReferenceRange[]\n  mappings        CodeMapping[]\n  labResults      LabResultStandardization[]\n  \n  // Metadata\n  createdAt       DateTime        @default(now())\n  updatedAt       DateTime        @updatedAt\n  \n  @@index([loincNumber])\n  @@index([component])\n  @@index([category])\n  @@index([componentType])\n  @@index([status])\n  @@index([commonName])\n}\n\n// LOINC Unit Model\nmodel LOINCUnit {\n  id                String      @id @default(cuid())\n  loincCodeId       String\n  loincCode         LOINCCode   @relation(fields: [loincCodeId], references: [id], onDelete: Cascade)\n  \n  // Unit Information\n  unit              String      // e.g., "mg/dL"\n  ucumCode          String      // UCUM code e.g., "mg/dL"\n  unitSystem        UnitSystem\n  \n  // Conversion\n  conversionFactor  Float?      // Factor to convert to primary unit\n  isPrimary         Boolean     @default(false)\n  \n  // Metadata\n  createdAt         DateTime    @default(now())\n  \n  @@index([loincCodeId])\n  @@index([unit])\n  @@index([isPrimary])\n}\n\n// Reference Range Model\nmodel ReferenceRange {\n  id              String              @id @default(cuid())\n  loincCodeId     String\n  loincCode       LOINCCode           @relation(fields: [loincCodeId], references: [id], onDelete: Cascade)\n  \n  // Range Type\n  type            ReferenceRangeType  @default(NORMAL)\n  \n  // Range Values\n  lowValue        Float?\n  highValue       Float?\n  unit            String\n  \n  // Demographics\n  ageMin          Int?                // Minimum age in years\n  ageMax          Int?                // Maximum age in years\n  gender          String?             // MALE, FEMALE, OTHER, ALL\n  \n  // Conditions\n  condition       String?             // e.g., "Pregnant", "Fasting"\n  population      String?             // e.g., "Adult", "Pediatric"\n  \n  // Source\n  source          String              @default("Mayo Clinic")\n  effectiveDate   DateTime            @default(now())\n  \n  // Relationships\n  labResults      LabResultStandardization[]\n  \n  // Metadata\n  createdAt       DateTime            @default(now())\n  \n  @@index([loincCodeId])\n  @@index([type])\n  @@index([gender])\n  @@index([ageMin, ageMax])\n}\n\n// Code Mapping Model (for mapping between coding systems)\nmodel CodeMapping {\n  id              String      @id @default(cuid())\n  \n  // Source (LOINC)\n  loincCode       String\n  loinc           LOINCCode   @relation(fields: [loincCode], references: [loincNumber], onDelete: Cascade)\n  \n  // Target System\n  targetSystem    String      // e.g., "SNOMED-CT", "CPT", "ICD-10"\n  targetCode      String\n  targetName      String?\n  \n  // Relationship\n  relationship    String      // EQUIVALENT, BROADER, NARROWER, RELATED\n  confidence      Float       @default(1.0) // 0-1\n  \n  // Source\n  source          String      @default("Manual")\n  \n  // Metadata\n  createdAt       DateTime    @default(now())\n  \n  @@unique([loincCode, targetSystem, targetCode])\n  @@index([loincCode])\n  @@index([targetSystem])\n  @@index([targetCode])\n  @@index([confidence])\n}\n\n// Lab Result Standardization Model\nmodel LabResultStandardization {\n  id                  String          @id @default(cuid())\n  \n  // Original Data (from EHR provider)\n  originalCode        String          // Provider-specific code\n  originalCodeSystem  String          // e.g., "EPIC", "CERNER"\n  originalName        String\n  originalValue       String          // Store as string to handle all types\n  originalUnit        String?\n  \n  // Standardized Data (LOINC)\n  loincCodeId         String\n  loincCode           LOINCCode       @relation(fields: [loincCodeId], references: [id])\n  standardizedValue   Float?          // Numeric value if quantitative\n  standardizedUnit    String?\n  \n  // Interpretation\n  interpretation      String?         // NORMAL, LOW, HIGH, CRITICAL_LOW, CRITICAL_HIGH\n  flags               String[]        // Additional flags\n  referenceRangeId    String?\n  referenceRange      ReferenceRange? @relation(fields: [referenceRangeId], references: [id])\n  \n  // Context\n  patientId           String\n  patient             User            @relation(fields: [patientId], references: [id], onDelete: Cascade)\n  fhirResourceId      String?\n  fhirResource        FHIRResource?   @relation(fields: [fhirResourceId], references: [id])\n  \n  // Audit\n  standardizedAt      DateTime        @default(now())\n  standardizedBy      String          @default("SYSTEM")\n  \n  // Metadata\n  createdAt           DateTime        @default(now())\n  updatedAt           DateTime        @updatedAt\n  \n  @@index([originalCode, originalCodeSystem])\n  @@index([loincCodeId])\n  @@index([patientId])\n  @@index([interpretation])\n  @@index([standardizedAt])\n}\n\n// SNOMED CT Code Model (for diagnoses, procedures, etc.)\nmodel SNOMEDCode {\n  id              String      @id @default(cuid())\n  snomedId        String      @unique // e.g., "73211009"\n  \n  // Display\n  preferredTerm   String      // Preferred display name\n  fullySpecified  String      // Fully specified name\n  synonyms        String[]    // Alternative names\n  \n  // Classification\n  semanticTag     String      // e.g., "disorder", "procedure"\n  hierarchy       String[]    // Parent concepts\n  \n  // Status\n  status          String      @default("ACTIVE")\n  effectiveDate   DateTime    @default(now())\n  \n  // Metadata\n  createdAt       DateTime    @default(now())\n  updatedAt       DateTime    @updatedAt\n  \n  @@index([snomedId])\n  @@index([preferredTerm])\n  @@index([semanticTag])\n  @@index([status])\n}\n\n// RxNorm Code Model (for medications)\nmodel RxNormCode {\n  id              String      @id @default(cuid())\n  rxcui           String      @unique // RxNorm Concept Unique Identifier\n  \n  // Display\n  name            String      // Drug name\n  synonym         String?     // Alternative name\n  \n  // Classification\n  termType        String      // e.g., "SCD" (Semantic Clinical Drug)\n  strength        String?     // e.g., "500 mg"\n  doseForm        String?     // e.g., "Tablet"\n  \n  // Relationships\n  ingredients     String[]    // Active ingredients\n  brandNames      String[]    // Brand names\n  \n  // Status\n  status          String      @default("ACTIVE")\n  \n  // Metadata\n  createdAt       DateTime    @default(now())\n  updatedAt       DateTime    @updatedAt\n  \n  @@index([rxcui])\n  @@index([name])\n  @@index([termType])\n  @@index([status])\n}\n\n// ICD-10 Code Model (for diagnoses)\nmodel ICD10Code {\n  id              String      @id @default(cuid())\n  code            String      @unique // e.g., "E11.9"\n  \n  // Display\n  description     String      // Full description\n  shortDescription String?    // Abbreviated description\n  \n  // Classification\n  category        String      // e.g., "Endocrine"\n  subcategory     String?\n  \n  // Billing\n  billable        Boolean     @default(true)\n  \n  // Status\n  status          String      @default("ACTIVE")\n  effectiveDate   DateTime    @default(now())\n  \n  // Metadata\n  createdAt       DateTime    @default(now())\n  updatedAt       DateTime    @updatedAt\n  \n  @@index([code])\n  @@index([description])\n  @@index([category])\n  @@index([billable])\n  @@index([status])\n}\n\n// CPT Code Model (for procedures)\nmodel CPTCode {\n  id              String      @id @default(cuid())\n  code            String      @unique // e.g., "99213"\n  \n  // Display\n  description     String      // Full description\n  shortDescription String?    // Abbreviated description\n  \n  // Classification\n  category        String      // e.g., "Evaluation and Management"\n  subcategory     String?\n  \n  // Billing\n  rvuWork         Float?      // Relative Value Unit - Work\n  rvuPractice     Float?      // RVU - Practice Expense\n  rvuMalpractice  Float?      // RVU - Malpractice\n  \n  // Status\n  status          String      @default("ACTIVE")\n  effectiveDate   DateTime    @default(now())\n  \n  // Metadata\n  createdAt       DateTime    @default(now())\n  updatedAt       DateTime    @updatedAt\n  \n  @@index([code])\n  @@index([description])\n  @@index([category])\n  @@index([status])\n}\n</create-file>\n</function_calls>'}