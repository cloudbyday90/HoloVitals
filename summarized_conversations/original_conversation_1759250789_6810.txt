{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="medical-analysis-platform/app/api/analyze/route.ts">\nimport { NextRequest, NextResponse } from \'next/server\';\nimport { aiService } from \'@/lib/services/ai.service\';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { documentId, query, userId } = body;\n\n    if (!documentId || !query) {\n      return NextResponse.json(\n        { error: \'Missing required fields: documentId and query\' },\n        { status: 400 }\n      );\n    }\n\n    // In production, get userId from session/auth\n    const effectiveUserId = userId || \'demo-user\';\n\n    // Analyze with AI\n    const response = await aiService.analyzeWithContext(\n      query,\n      documentId,\n      effectiveUserId\n    );\n\n    return NextResponse.json({\n      success: true,\n      response\n    });\n  } catch (error) {\n    console.error(\'Analysis error:\', error);\n    return NextResponse.json(\n      { \n        error: \'Failed to analyze document\',\n        message: error instanceof Error ? error.message : \'Unknown error\'\n      },\n      { status: 500 }\n    );\n  }\n}\n</create-file>\n</function_calls>'}