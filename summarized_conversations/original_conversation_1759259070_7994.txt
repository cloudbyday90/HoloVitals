{'role': 'assistant', 'content': 'Now let me create a comprehensive visual diagram document to help visualize the entire system:\n\n<function_calls>\n<create-file file_path="docs/SYSTEM_DIAGRAMS.md">\n# HoloVitals System Diagrams\n\n## Table of Contents\n1. [High-Level Architecture](#high-level-architecture)\n2. [User Flow Diagrams](#user-flow-diagrams)\n3. [AI Processing Flow](#ai-processing-flow)\n4. [Data Flow Diagrams](#data-flow-diagrams)\n5. [Infrastructure Diagrams](#infrastructure-diagrams)\n6. [Security Architecture](#security-architecture)\n\n---\n\n## High-Level Architecture\n\n### Complete System Overview\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              USER LAYER                                      │\n│                                                                              │\n│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │\n│  │   Patient    │  │   Provider   │  │    Admin     │  │  Compliance  │  │\n│  │   Portal     │  │   Portal     │  │   Portal     │  │   Officer    │  │\n│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  │\n│         │                  │                  │                  │          │\n└─────────┼──────────────────┼──────────────────┼──────────────────┼──────────┘\n          │                  │                  │                  │\n          └──────────────────┴──────────────────┴──────────────────┘\n                                      │\n                                      ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           PRESENTATION LAYER                                 │\n│                         (Next.js 14 Frontend)                                │\n│                                                                              │\n│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │\n│  │  Dashboard   │  │     Chat     │  │    Upload    │  │   Settings   │  │\n│  │  Component   │  │  Interface   │  │  Component   │  │  Component   │  │\n│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  │\n│                                                                              │\n└──────────────────────────────────────┬───────────────────────────────────────┘\n                                       │ HTTPS/TLS 1.3\n                                       ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                            API GATEWAY LAYER                                 │\n│                    (Azure API Management / AWS API Gateway)                  │\n│                                                                              │\n│  • Authentication (JWT + MFA)    • Rate Limiting                            │\n│  • Request Validation            • Logging & Monitoring                     │\n│  • HIPAA Compliance Checks       • DDoS Protection                          │\n│                                                                              │\n└──────────────────────────────────────┬───────────────────────────────────────┘\n                                       │\n                    ┌──────────────────┴──────────────────┐\n                    │                                     │\n                    ▼                                     ▼\n┌────────────────────────────────────┐  ┌────────────────────────────────────┐\n│     APPLICATION LAYER              │  │      AI PROCESSING LAYER           │\n│     (Always Running)               │  │      (Ephemeral)                   │\n│                                    │  │                                    │\n│  ┌──────────────────────────────┐ │  │  ┌──────────────────────────────┐ │\n│  │  Lightweight Chatbot         │ │  │  │  Analysis Queue              │ │\n│  │  (GPT-3.5 Turbo)            │ │  │  │  (Priority-based)            │ │\n│  │  • <2 sec response          │ │  │  │  • URGENT, HIGH, NORMAL, LOW │ │\n│  │  • General queries          │ │  │  └──────────────────────────────┘ │\n│  │  • Navigation help          │ │  │              │                     │\n│  └──────────────────────────────┘ │  │              ▼                     │\n│                                    │  │  ┌──────────────────────────────┐ │\n│  ┌──────────────────────────────┐ │  │  │  Context Optimizer           │ │\n│  │  Document Processing         │ │  │  │  • Token analysis            │ │\n│  │  • Upload handling          │ │  │  │  • Model selection           │ │\n│  │  • OCR extraction           │ │  │  │  • Prompt splitting          │ │\n│  │  • Metadata extraction      │ │  │  └──────────────────────────────┘ │\n│  └──────────────────────────────┘ │  │              │                     │\n│                                    │  │              ▼                     │\n│  ┌──────────────────────────────┐ │  │  ┌──────────────────────────────┐ │\n│  │  User Management             │ │  │  │  Instance Provisioner        │ │\n│  │  • Authentication           │ │  │  │  • Spin up GPU instance      │ │\n│  │  • Authorization            │ │  │  │  • Load LLM model            │ │\n│  │  • Consent management       │ │  │  │  • Execute analysis          │ │\n│  └──────────────────────────────┘ │  │  │  • Terminate instance        │ │\n│                                    │  │  └──────────────────────────────┘ │\n│  ┌──────────────────────────────┐ │  │              │                     │\n│  │  HIPAA Compliance            │ │  │              ▼                     │\n│  │  • PHI sanitization         │ │  │  ┌──────────────────────────────┐ │\n│  │  • Access logging           │ │  │  │  Heavy-Duty Analysis         │ │\n│  │  • Audit trail              │ │  │  │  • GPT-4 Turbo               │ │\n│  └──────────────────────────────┘ │  │  │  • Claude 3 Opus/Sonnet      │ │\n│                                    │  │  │  • Llama 3 70B               │ │\n└────────────────────────────────────┘  │  │  • 5-30 min analysis         │ │\n                                        │  └──────────────────────────────┘ │\n                                        │                                    │\n                                        │  Lifecycle: 8-30 minutes           │\n                                        │  Auto-terminate after completion   │\n                                        └────────────────────────────────────┘\n                                                       │\n                    ┌──────────────────────────────────┴──────────────────┐\n                    │                                                     │\n                    ▼                                                     ▼\n┌────────────────────────────────────┐  ┌────────────────────────────────────┐\n│         DATA LAYER                 │  │      REPOSITORY LAYER              │\n│                                    │  │                                    │\n│  ┌──────────────────────────────┐ │  │  ┌──────────────────────────────┐ │\n│  │  PostgreSQL Database         │ │  │  │  Patient Repository          │ │\n│  │  • User data                │ │  │  │  • Sandboxed per patient     │ │\n│  │  • Metadata                 │ │  │  │  • Identity-based access     │ │\n│  │  • Audit logs               │ │  │  └──────────────────────────────┘ │\n│  │  • Queue state              │ │  │                                    │\n│  └──────────────────────────────┘ │  │  ┌──────────────────────────────┐ │\n│                                    │  │  │  AI Analysis Repository      │ │\n│  ┌──────────────────────────────┐ │  │  │  • Analysis results          │ │\n│  │  Redis Cache                 │ │  │  │  • Priority queue            │ │\n│  │  • Session data             │ │  │  │  • Missing data tracking     │ │\n│  │  • Queue management         │ │  │  └──────────────────────────────┘ │\n│  │  • Temporary data           │ │  │                                    │\n│  └──────────────────────────────┘ │  │  ┌──────────────────────────────┐ │\n│                                    │  │  │  AI Context Cache            │ │\n│  ┌──────────────────────────────┐ │  │  │  • PHI-sanitized cache       │ │\n│  │  Blob Storage                │ │  │  │  • Importance scoring        │ │\n│  │  • Medical documents        │ │  │  │  • Smart eviction            │ │\n│  │  • Analysis results         │ │  │  └──────────────────────────────┘ │\n│  │  • Encrypted backups        │ │  │                                    │\n│  └──────────────────────────────┘ │  │  ┌──────────────────────────────┐ │\n│                                    │  │  │  HIPAA Compliance Repo       │ │\n│  All encrypted with AES-256-GCM   │  │  │  • Compliance rules          │ │\n│                                    │  │  │  • Audit logs                │ │\n└────────────────────────────────────┘  │  │  • Violation tracking        │ │\n                                        │  └──────────────────────────────┘ │\n                                        └────────────────────────────────────┘\n```\n\n---\n\n## User Flow Diagrams\n\n### 1. New User Onboarding Flow\n\n```\nSTART\n  │\n  ▼\n┌─────────────────────────┐\n│  User visits website    │\n└───────────┬─────────────┘\n            │\n            ▼\n┌─────────────────────────┐\n│  Click "Get Started"    │\n└───────────┬─────────────┘\n            │\n            ▼\n┌─────────────────────────────────────────────────────────────┐\n│  STEP 1: Identity Verification                              │\n│                                                              │\n│  Enter:                                                      │\n│  • Full Name                                                 │\n│  • Date of Birth                                             │\n│  • Place of Birth                                            │\n│                                                              │\n│  [Continue] →                                                │\n└───────────┬─────────────────────────────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────────────────────────────┐\n│  STEP 2: Additional Verification (Optional)                 │\n│                                                              │\n│  Provide at least 2 of:                                      │\n│  ☐ Last 4 digits of SSN                                     │\n│  ☐ Mother\'s Maiden Name                                     │\n│  ☐ Medical Record Number                                    │\n│  ☐ Previous Address                                         │\n│  ☐ Phone Number                                             │\n│                                                              │\n│  [Skip]  [Continue] →                                        │\n└───────────┬─────────────────────────────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────────────────────────────┐\n│  STEP 3: Health Profile (Optional)                          │\n│                                                              │\n│  • Current Medications [+ Add]                               │\n│  • Known Allergies [+ Add]                                   │\n│  • Chronic Conditions [+ Add]                                │\n│                                                              │\n│  [Skip for now]  [Continue] →                                │\n└───────────┬─────────────────────────────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────────────────────────────┐\n│  STEP 4: Document Upload (Optional)                         │\n│                                                              │\n│  ┌─────────────────────────────────────────────────────┐   │\n│  │  Drag & drop medical documents here                 │   │\n│  │  or click to browse                                 │   │\n│  │                                                      │   │\n│  │  Supported: PDF, JPG, PNG                           │   │\n│  └─────────────────────────────────────────────────────┘   │\n│                                                              │\n│  [Skip for now]  [Finish Setup] →                           │\n└───────────┬─────────────────────────────────────────────────┘\n            │\n            ▼\n┌─────────────────────────┐\n│  Welcome to Dashboard!  │\n│                         │\n│  💬 Chat interface      │\n│  📄 Upload documents    │\n│  ⚙️  Settings           │\n└─────────────────────────┘\n            │\n            ▼\n          END\n```\n\n### 2. Document Analysis Flow\n\n```\nSTART: User uploads document\n  │\n  ▼\n┌─────────────────────────────────────┐\n│  Document Upload Handler            │\n│  • Validate file type               │\n│  • Check file size                  │\n│  • Scan for malware                 │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  Document Processing                │\n│  • Extract text (OCR if needed)     │\n│  • Extract metadata                 │\n│  • Identify document type           │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  Create Analysis Task               │\n│  • Generate task ID                 │\n│  • Set priority (NORMAL)            │\n│  • Add to queue                     │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  Notify User                        │\n│  "Your document is being analyzed"  │\n│  "Estimated time: 15 minutes"       │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  Context Optimizer                  │\n│  • Count tokens                     │\n│  • Select optimal model             │\n│  • Determine if splitting needed    │\n└───────────┬─────────────────────────┘\n            │\n            ├─── Splitting NOT needed ───┐\n            │                            │\n            │                            ▼\n            │              ┌─────────────────────────────────┐\n            │              │  Single Analysis                │\n            │              │  • Provision 1 instance         │\n            │              │  • Load model                   │\n            │              │  • Run analysis                 │\n            │              │  • Terminate instance           │\n            │              └───────────┬─────────────────────┘\n            │                          │\n            └─── Splitting needed ─────┤\n                           │           │\n                           ▼           │\n            ┌─────────────────────────────────┐\n            │  Split Analysis                 │\n            │  • Split into chunks            │\n            │  • Provision N instances        │\n            │  • Run parallel/sequential      │\n            │  • Merge results                │\n            │  • Terminate instances          │\n            └───────────┬─────────────────────┘\n                        │\n                        └─────────────┬───────┘\n                                      │\n                                      ▼\n                        ┌─────────────────────────────────┐\n                        │  PHI Sanitization               │\n                        │  • Remove all PHI identifiers   │\n                        │  • Validate sanitization        │\n                        └───────────┬─────────────────────┘\n                                    │\n                                    ▼\n                        ┌─────────────────────────────────┐\n                        │  Store Results                  │\n                        │  • Save to database             │\n                        │  • Cache (sanitized)            │\n                        │  • Update task status           │\n                        └───────────┬─────────────────────┘\n                                    │\n                                    ▼\n                        ┌─────────────────────────────────┐\n                        │  Notify User                    │\n                        │  "Analysis complete!"           │\n                        │  [View Results]                 │\n                        └─────────────────────────────────┘\n                                    │\n                                    ▼\n                                  END\n```\n\n### 3. Chat Interaction Flow\n\n```\nSTART: User types message\n  │\n  ▼\n┌─────────────────────────────────────┐\n│  Lightweight Chatbot                │\n│  • Receive message                  │\n│  • Analyze intent                   │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n      ┌─────┴─────┐\n      │  Decision │\n      └─────┬─────┘\n            │\n    ┌───────┴───────┐\n    │               │\n    ▼               ▼\nSimple Query    Complex Query\n    │               │\n    ▼               ▼\n┌─────────────┐  ┌─────────────────────────────────┐\n│ GPT-3.5     │  │  Escalate to Deep Analysis      │\n│ Response    │  │  • Create analysis task         │\n│ <2 seconds  │  │  • Add to queue                 │\n└──────┬──────┘  │  • Notify user of wait time     │\n       │         └───────────┬─────────────────────┘\n       │                     │\n       │                     ▼\n       │         ┌─────────────────────────────────┐\n       │         │  Queue Processing               │\n       │         │  (See Document Analysis Flow)   │\n       │         └───────────┬─────────────────────┘\n       │                     │\n       └──────────┬──────────┘\n                  │\n                  ▼\n      ┌─────────────────────┐\n      │  Display Response   │\n      │  • Show in chat     │\n      │  • Save to history  │\n      └─────────────────────┘\n                  │\n                  ▼\n                END\n```\n\n---\n\n## AI Processing Flow\n\n### Ephemeral Instance Lifecycle\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│                    INSTANCE LIFECYCLE                                │\n└─────────────────────────────────────────────────────────────────────┘\n\nPHASE 1: PROVISIONING (2-3 minutes)\n┌─────────────────────────────────────┐\n│  1. Request instance from cloud     │\n│     • Azure: Standard_NC6s_v3       │\n│     • AWS: p3.2xlarge               │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  2. Instance starts                 │\n│     • Boot OS                       │\n│     • Initialize GPU                │\n│     • Load Docker container         │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  3. Load model weights              │\n│     • Download from secure storage  │\n│     • Load into GPU memory          │\n│     • Warm up model                 │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  4. Health check                    │\n│     • Verify model loaded           │\n│     • Test inference                │\n│     • Mark as READY                 │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n\nPHASE 2: READY (<1 minute)\n┌─────────────────────────────────────┐\n│  5. Accept analysis request         │\n│     • Receive task from queue       │\n│     • Load patient data (encrypted) │\n│     • Prepare context               │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n\nPHASE 3: EXECUTING (5-25 minutes)\n┌─────────────────────────────────────┐\n│  6. Run LLM inference               │\n│     • Process input tokens          │\n│     • Generate analysis             │\n│     • Stream results                │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  7. Validate results                │\n│     • Check completeness            │\n│     • Verify format                 │\n│     • Quality check                 │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  8. Sanitize PHI                    │\n│     • Remove all identifiers        │\n│     • Validate sanitization         │\n│     • Prepare for storage           │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n\nPHASE 4: DEPROVISIONING (<1 minute)\n┌─────────────────────────────────────┐\n│  9. Save results                    │\n│     • Upload to secure storage      │\n│     • Update database               │\n│     • Notify user                   │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  10. Clear all PHI                  │\n│      • Wipe memory                  │\n│      • Clear disk                   │\n│      • Verify deletion              │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  11. Terminate instance             │\n│      • Stop container               │\n│      • Deallocate resources         │\n│      • Log costs                    │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  12. Cleanup complete               │\n│      • Instance terminated          │\n│      • Resources released           │\n│      • Ready for next task          │\n└─────────────────────────────────────┘\n\nTOTAL TIME: 8-30 minutes\nCOST: $0.12 - $1.53 per analysis\n```\n\n---\n\n## Data Flow Diagrams\n\n### Patient Data Flow (HIPAA-Compliant)\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│                        PATIENT DATA FLOW                             │\n└─────────────────────────────────────────────────────────────────────┘\n\nINPUT: Patient uploads document\n  │\n  ▼\n┌─────────────────────────────────────┐\n│  1. Upload Handler                  │\n│     • Receive file                  │\n│     • Validate format               │\n│     • Scan for malware              │\n│     ✓ Encrypted in transit (TLS 1.3)│\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  2. Blob Storage                    │\n│     • Store encrypted file          │\n│     • Generate unique ID            │\n│     ✓ Encrypted at rest (AES-256)  │\n│     ✓ Access logged                │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  3. Document Processing             │\n│     • Extract text (OCR)            │\n│     • Extract metadata              │\n│     • Identify PHI                  │\n│     ✓ Processing in memory only    │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  4. Patient Repository              │\n│     • Store metadata                │\n│     • Link to blob storage          │\n│     ✓ Sandboxed per patient        │\n│     ✓ Identity-based access        │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  5. Analysis Queue                  │\n│     • Create analysis task          │\n│     • Set priority                  │\n│     ✓ Task ID logged               │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  6. Ephemeral Instance              │\n│     • Load document (encrypted)     │\n│     • Run analysis                  │\n│     • Generate results              │\n│     ✓ PHI in memory only           │\n│     ✓ No persistent storage        │\n└───────────┬─────────────────────────┘\n            │\n            ▼\n┌─────────────────────────────────────┐\n│  7. PHI Sanitization                │\n│     • Remove all identifiers        │\n│     • Validate sanitization         │\n│     ✓ Compliance verified          │\n└───────────┬─────────────────────────┘\n            │\n            ├─── Original (with PHI) ───┐\n            │                           │\n            │                           ▼\n            │              ┌─────────────────────────────────┐\n            │              │  8a. Secure Storage             │\n            │              │      • Store encrypted          │\n            │              │      • Patient access only      │\n            │              │      ✓ Audit logged            │\n            │              └─────────────────────────────────┘\n            │\n            └─── Sanitized (no PHI) ────┐\n                                        │\n                                        ▼\n                           ┌─────────────────────────────────┐\n                           │  8b. Context Cache              │\n                           │      • Store for reuse          │\n                           │      • Importance scoring       │\n                           │      ✓ No PHI present          │\n                           └─────────────────────────────────┘\n                                        │\n                                        ▼\n                           ┌─────────────────────────────────┐\n                           │  9. Notify Patient              │\n                           │     • Analysis complete         │\n                           │     • Results available         │\n                           │     ✓ Notification logged      │\n                           └─────────────────────────────────┘\n                                        │\n                                        ▼\n                                    OUTPUT\n\n✓ = HIPAA Compliance Checkpoint\n```\n\n---\n\n## Infrastructure Diagrams\n\n### Cloud Infrastructure (Azure)\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│                          INTERNET                                    │\n└────────────────────────────┬────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    Azure Front Door                                  │\n│  • Global load balancing                                             │\n│  • DDoS protection                                                   │\n│  • WAF (Web Application Firewall)                                    │\n└────────────────────────────┬────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    Azure API Management                              │\n│  • API gateway                                                       │\n│  • Rate limiting                                                     │\n│  • Authentication                                                    │\n│  • Request validation                                                │\n└────────────────────────────┬────────────────────────────────────────┘\n                             │\n                ┌────────────┴────────────┐\n                │                         │\n                ▼                         ▼\n┌───────────────────────────┐  ┌──────────────────────────────┐\n│   PUBLIC SUBNET           │  │   PRIVATE SUBNET             │\n│   (10.0.1.0/24)          │  │   (10.0.2.0/24)             │\n│                           │  │                              │\n│  ┌─────────────────────┐ │  │  ┌─────────────────────────┐│\n│  │ Azure Kubernetes    │ │  │  │ PostgreSQL Flexible     ││\n│  │ Service (AKS)       │ │  │  │ Server                  ││\n│  │                     │ │  │  │ • Zone redundant        ││\n│  │ • Application pods  │ │  │  │ • Geo-replicated        ││\n│  │ • Auto-scaling      │ │  │  │ • Encrypted             ││\n│  │ • Load balancing    │ │  │  └─────────────────────────┘│\n│  └─────────────────────┘ │  │                              │\n│                           │  │  ┌─────────────────────────┐│\n│  ┌─────────────────────┐ │  │  │ Redis Cache             ││\n│  │ Application Gateway │ │  │  │ • Premium tier          ││\n│  │ • SSL termination   │ │  │  │ • Persistence enabled   ││\n│  │ • Path routing      │ │  │  │ • Geo-replication       ││\n│  └─────────────────────┘ │  │  └─────────────────────────┘│\n│                           │  │                              │\n└───────────────────────────┘  │  ┌─────────────────────────┐│\n                               │  │ GPU Instances           ││\n                               │  │ (Ephemeral)             ││\n                               │  │                         ││\n                               │  │ • NC6s_v3 (1x V100)     ││\n                               │  │ • NC12s_v3 (2x V100)    ││\n                               │  │ • NC24s_v3 (4x V100)    ││\n                               │  │                         ││\n                               │  │ Lifecycle: 8-30 min     ││\n                               │  └─────────────────────────┘│\n                               └──────────────────────────────┘\n\n┌─────────────────────────────────────────────────────────────────────┐\n│                    SHARED SERVICES                                   │\n│                                                                      │\n│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │\n│  │ Azure Key    │  │ Azure        │  │ Azure        │             │\n│  │ Vault        │  │ Monitor      │  │ Storage      │             │\n│  │              │  │              │  │ Account      │             │\n│  │ • Secrets    │  │ • Logs       │  │              │             │\n│  │ • Keys       │  │ • Metrics    │  │ • Blobs      │             │\n│  │ • Certs      │  │ • Alerts     │  │ • Queues     │             │\n│  └──────────────┘  └──────────────┘  └──────────────┘             │\n│                                                                      │\n│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐             │\n│  │ Azure        │  │ Azure        │  │ Azure        │             │\n│  │ Container    │  │ Health Data  │  │ Backup       │             │\n│  │ Registry     │  │ Services     │  │              │             │\n│  │              │  │              │  │ • Daily      │             │\n│  │ • Images     │  │ • FHIR API   │  │ • Geo-       │             │\n│  │ • Geo-rep    │  │ • DICOM      │  │   redundant  │             │\n│  └──────────────┘  └──────────────┘  └──────────────┘             │\n└─────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Security Architecture\n\n### Multi-Layer Security Model\n\n```\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 1: NETWORK SECURITY                         │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • DDoS Protection (Azure Front Door)                        │  │\n│  │  • WAF (Web Application Firewall)                            │  │\n│  │  • Network Security Groups (NSGs)                            │  │\n│  │  • Private VNet/VPC                                          │  │\n│  │  • No public IPs on backend services                         │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 2: APPLICATION SECURITY                     │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • TLS 1.3 only                                              │  │\n│  │  • Certificate pinning                                       │  │\n│  │  • HSTS (HTTP Strict Transport Security)                    │  │\n│  │  • CSP (Content Security Policy)                            │  │\n│  │  • Rate limiting                                             │  │\n│  │  • Input validation                                          │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 3: AUTHENTICATION                           │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • Multi-Factor Authentication (MFA) required                │  │\n│  │  • TOTP-based (Google Authenticator)                         │  │\n│  │  • Password strength requirements                            │  │\n│  │  • Account lockout (5 failed attempts)                       │  │\n│  │  • Session timeout (30 minutes)                              │  │\n│  │  • Bcrypt password hashing (12 rounds)                       │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 4: AUTHORIZATION                            │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • Role-Based Access Control (RBAC)                          │  │\n│  │  • Minimum necessary principle                               │  │\n│  │  • Explicit patient consent required                         │  │\n│  │  • Time-limited access (max 72 hours)                        │  │\n│  │  • Granular permissions                                      │  │\n│  │  • Access revocation                                         │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 5: DATA ENCRYPTION                          │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  At Rest:                                                     │  │\n│  │  • AES-256-GCM encryption                                     │  │\n│  │  • Separate keys per patient                                 │  │\n│  │  • Key rotation (90 days)                                    │  │\n│  │  • Azure Key Vault / AWS KMS                                 │  │\n│  │                                                               │  │\n│  │  In Transit:                                                  │  │\n│  │  • TLS 1.3 only                                              │  │\n│  │  • Perfect Forward Secrecy                                   │  │\n│  │  • Certificate pinning                                       │  │\n│  │                                                               │  │\n│  │  In Memory:                                                   │  │\n│  │  • Encrypted memory for PHI                                  │  │\n│  │  • Memory scrubbing on deallocation                          │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 6: AUDIT & MONITORING                       │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • Complete audit trail                                       │  │\n│  │  • All PHI access logged                                      │  │\n│  │  • Real-time anomaly detection                                │  │\n│  │  • Suspicious activity alerts                                 │  │\n│  │  • Compliance monitoring                                      │  │\n│  │  • Security incident response                                 │  │\n│  │  • Log retention (7 years)                                    │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n                             │\n                             ▼\n┌─────────────────────────────────────────────────────────────────────┐\n│                    LAYER 7: COMPLIANCE                               │\n│                                                                      │\n│  ┌──────────────────────────────────────────────────────────────┐  │\n│  │  • HIPAA compliance checks                                    │  │\n│  │  • PHI sanitization                                           │  │\n│  │  • Consent verification                                       │  │\n│  │  • Breach notification procedures                             │  │\n│  │  • Regular compliance audits                                  │  │\n│  │  • Business Associate Agreements (BAAs)                       │  │\n│  └──────────────────────────────────────────────────────────────┘  │\n└─────────────────────────────────────────────────────────────────────┘\n```\n\n---\n\n## Summary\n\nThese diagrams provide a comprehensive visual representation of the HoloVitals system architecture, including:\n\n1. **High-Level Architecture** - Complete system overview\n2. **User Flows** - Onboarding, document analysis, chat interactions\n3. **AI Processing** - Ephemeral instance lifecycle\n4. **Data Flow** - HIPAA-compliant patient data handling\n5. **Infrastructure** - Cloud architecture (Azure/AWS)\n6. **Security** - Multi-layer security model\n\nAll diagrams emphasize:\n- ✅ HIPAA compliance at every layer\n- ✅ Encryption everywhere (at rest, in transit, in memory)\n- ✅ Ephemeral instances for cost efficiency and security\n- ✅ Complete audit trails\n- ✅ Multi-layer security\n- ✅ Scalability and high availability\n\nUse these diagrams for:\n- Team onboarding\n- Architecture reviews\n- Compliance audits\n- Stakeholder presentations\n- Development planning\n</create-file>\n</function_calls>'}