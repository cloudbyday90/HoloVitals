{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="medical-analysis-platform/components/analysis/chat-interface.tsx">\n\'use client\';\n\nimport { useState, useRef, useEffect } from \'react\';\nimport { Send, Loader2, Bot, User } from \'lucide-react\';\nimport { Card, CardContent, CardHeader, CardTitle } from \'@/components/ui/card\';\nimport { Button } from \'@/components/ui/button\';\n\ninterface Message {\n  id: string;\n  role: \'user\' | \'assistant\';\n  content: string;\n  timestamp: Date;\n}\n\ninterface ChatInterfaceProps {\n  documentId: string;\n  onSendMessage: (message: string) => Promise<string>;\n}\n\nexport function ChatInterface({ documentId, onSendMessage }: ChatInterfaceProps) {\n  const [messages, setMessages] = useState<Message[]>([\n    {\n      id: \'1\',\n      role: \'assistant\',\n      content: \'Hello! I\\\'m here to help you analyze your medical documents. You can ask me questions about the document, request trend analysis, or get insights about your health data. What would you like to know?\',\n      timestamp: new Date()\n    }\n  ]);\n  const [input, setInput] = useState(\'\');\n  const [isLoading, setIsLoading] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \'smooth\' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const handleSend = async () => {\n    if (!input.trim() || isLoading) return;\n\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: \'user\',\n      content: input,\n      timestamp: new Date()\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setInput(\'\');\n    setIsLoading(true);\n\n    try {\n      const response = await onSendMessage(input);\n      \n      const assistantMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: \'assistant\',\n        content: response,\n        timestamp: new Date()\n      };\n\n      setMessages(prev => [...prev, assistantMessage]);\n    } catch (error) {\n      const errorMessage: Message = {\n        id: (Date.now() + 1).toString(),\n        role: \'assistant\',\n        content: \'I apologize, but I encountered an error processing your request. Please try again.\',\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, errorMessage]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === \'Enter\' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  const suggestedQuestions = [\n    \'What are the key findings in this document?\',\n    \'Are there any abnormal values?\',\n    \'How do these results compare to previous tests?\',\n    \'What should I discuss with my doctor?\'\n  ];\n\n  return (\n    <Card className="flex flex-col h-[600px]">\n      <CardHeader>\n        <CardTitle className="flex items-center gap-2">\n          <Bot className="w-5 h-5" />\n          AI Medical Analysis Assistant\n        </CardTitle>\n      </CardHeader>\n      \n      <CardContent className="flex-1 flex flex-col p-0">\n        {/* Messages Area */}\n        <div className="flex-1 overflow-y-auto p-6 space-y-4">\n          {messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex gap-3 ${message.role === \'user\' ? \'justify-end\' : \'justify-start\'}`}\n            >\n              {message.role === \'assistant\' && (\n                <div className="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">\n                  <Bot className="w-5 h-5 text-primary" />\n                </div>\n              )}\n              \n              <div\n                className={`\n                  max-w-[80%] rounded-lg p-4\n                  ${message.role === \'user\' \n                    ? \'bg-primary text-primary-foreground\' \n                    : \'bg-gray-100 text-gray-900\'\n                  }\n                `}\n              >\n                <p className="text-sm whitespace-pre-wrap">{message.content}</p>\n                <p className="text-xs opacity-70 mt-2">\n                  {message.timestamp.toLocaleTimeString()}\n                </p>\n              </div>\n\n              {message.role === \'user\' && (\n                <div className="w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0">\n                  <User className="w-5 h-5 text-primary-foreground" />\n                </div>\n              )}\n            </div>\n          ))}\n          \n          {isLoading && (\n            <div className="flex gap-3 justify-start">\n              <div className="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">\n                <Bot className="w-5 h-5 text-primary" />\n              </div>\n              <div className="bg-gray-100 rounded-lg p-4">\n                <Loader2 className="w-5 h-5 animate-spin text-gray-600" />\n              </div>\n            </div>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Suggested Questions */}\n        {messages.length === 1 && (\n          <div className="px-6 pb-4">\n            <p className="text-sm text-gray-600 mb-2">Suggested questions:</p>\n            <div className="flex flex-wrap gap-2">\n              {suggestedQuestions.map((question, index) => (\n                <button\n                  key={index}\n                  onClick={() => setInput(question)}\n                  className="text-xs px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-full transition-colors"\n                >\n                  {question}\n                </button>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Input Area */}\n        <div className="border-t p-4">\n          <div className="flex gap-2">\n            <textarea\n              value={input}\n              onChange={(e) => setInput(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder="Ask a question about your medical documents..."\n              className="flex-1 resize-none border rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-primary"\n              rows={2}\n              disabled={isLoading}\n            />\n            <Button\n              onClick={handleSend}\n              disabled={!input.trim() || isLoading}\n              size="icon"\n              className="h-auto"\n            >\n              {isLoading ? (\n                <Loader2 className="w-5 h-5 animate-spin" />\n              ) : (\n                <Send className="w-5 h-5" />\n              )}\n            </Button>\n          </div>\n          <p className="text-xs text-gray-500 mt-2">\n            Press Enter to send, Shift+Enter for new line\n          </p>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n</create-file>\n</function_calls>'}