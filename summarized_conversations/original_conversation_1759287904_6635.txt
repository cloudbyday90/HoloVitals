{'role': 'assistant', 'content': 'Now let\'s create comprehensive documentation for the multi-provider support:\n\n<function_calls>\n<create-file file_path="medical-analysis-platform/docs/MULTI_PROVIDER_SUPPORT.md">\n# Multi-Provider EHR Support\n\n## Overview\n\nHoloVitals now supports **6 major EHR providers** covering over **79% of the US healthcare market**. Each provider has a dedicated connector with provider-specific optimizations and features.\n\n---\n\n## Supported Providers\n\n### 1. Epic (MyChart) - 31% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: MyChart  \n**Sandbox**: Available\n\n**Features:**\n- Complete FHIR R4 support\n- DocumentReference for PDFs\n- DiagnosticReport support\n- CarePlan support\n- Bulk data export\n\n**Setup:**\n1. Register at: https://fhir.epic.com/Developer/Apps\n2. Get client ID\n3. Configure redirect URI\n4. No client secret required (public client)\n\n**Test Credentials:**\n- Sandbox URL: https://fhir.epic.com/\n- Username: fhirderrick / fhircamila\n- Password: epicepic1\n\n---\n\n### 2. Cerner/Oracle Health - 25% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: HealtheLife  \n**Sandbox**: Available\n\n**Features:**\n- Complete FHIR R4 support\n- Multi-tenant architecture\n- DocumentReference support\n- Observation and lab results\n- Medication and allergy data\n\n**Setup:**\n1. Register at: https://code-console.cerner.com/\n2. Get client ID and tenant ID\n3. Configure redirect URI\n4. No client secret required\n\n**Special Requirements:**\n- Requires tenant ID in URLs\n- Tenant-specific FHIR endpoints\n\n**Sandbox Tenant ID:**\n- `ec2458f2-1e24-41c8-b71b-0e701af7583d`\n\n---\n\n### 3. Allscripts - 8% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: FollowMyHealth  \n**Sandbox**: Available\n\n**Features:**\n- FHIR R4 support\n- DocumentReference support\n- Clinical data retrieval\n- Patient demographics\n\n**Setup:**\n1. Register at: https://developer.allscripts.com/\n2. Get client ID and client secret\n3. Configure redirect URI\n4. **Requires client secret** (confidential client)\n\n**Special Requirements:**\n- Client secret required\n- OAuth2 confidential client flow\n\n---\n\n### 4. athenahealth - 6% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: athenaPatient  \n**Sandbox**: Available\n\n**Features:**\n- FHIR R4 support\n- DocumentReference support\n- Observation data\n- Medication and allergy data\n\n**Setup:**\n1. Register at: https://developer.athenahealth.com/\n2. Get client ID and client secret\n3. Configure redirect URI\n4. **Requires client secret**\n\n**Special Requirements:**\n- Client secret required\n- Rate limiting: 40 requests/minute\n\n---\n\n### 5. eClinicalWorks - 5% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: Patient Portal V11  \n**Sandbox**: Available\n\n**Features:**\n- FHIR R4 support\n- DocumentReference support\n- Clinical data retrieval\n- Patient demographics\n\n**Setup:**\n1. Contact eClinicalWorks for API access\n2. Get client ID and client secret\n3. Configure redirect URI\n4. **Requires client secret**\n\n**Special Requirements:**\n- Client secret required\n- Rate limiting: 30 requests/minute\n\n---\n\n### 6. NextGen Healthcare - 4% Market Share ✅\n\n**Status**: Fully Supported  \n**Patient Portal**: NextGen Patient Portal  \n**Sandbox**: Available\n\n**Features:**\n- FHIR R4 support\n- DocumentReference support\n- Clinical data retrieval\n- Patient demographics\n\n**Setup:**\n1. Register at: https://developer.nextgen.com/\n2. Get client ID and client secret\n3. Configure redirect URI\n4. **Requires client secret**\n\n**Special Requirements:**\n- Client secret required\n- Rate limiting: 30 requests/minute\n\n---\n\n## Provider Comparison\n\n| Provider | Market Share | Sandbox | Client Secret | Rate Limit (req/min) | Bulk Data |\n|----------|--------------|---------|---------------|---------------------|-----------|\n| Epic | 31% | ✅ Yes | ❌ No | 60 | ✅ Yes |\n| Cerner | 25% | ✅ Yes | ❌ No | 60 | ✅ Yes |\n| Allscripts | 8% | ✅ Yes | ✅ Yes | 30 | ❌ No |\n| athenahealth | 6% | ✅ Yes | ✅ Yes | 40 | ❌ No |\n| eClinicalWorks | 5% | ✅ Yes | ✅ Yes | 30 | ❌ No |\n| NextGen | 4% | ✅ Yes | ✅ Yes | 30 | ❌ No |\n\n**Total Market Coverage: 79%**\n\n---\n\n## Architecture\n\n### Connector Framework\n\n```\n┌─────────────────────────────────────────────────────────┐\n│              ConnectorFactory                            │\n│  (Creates provider-specific connectors)                 │\n└─────────────────────────────────────────────────────────┘\n                        │\n        ┌───────────────┼───────────────┐\n        │               │               │\n        ▼               ▼               ▼\n┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n│EpicConnector │ │CernerConnector│ │AllscriptsConn│\n└──────────────┘ └──────────────┘ └──────────────┘\n        │               │               │\n        └───────────────┼───────────────┘\n                        │\n                        ▼\n            ┌──────────────────────┐\n            │  BaseEHRConnector    │\n            │  (Abstract base)     │\n            └──────────────────────┘\n                        │\n        ┌───────────────┼───────────────┐\n        │               │               │\n        ▼               ▼               ▼\n┌──────────────┐ ┌──────────────┐ ┌──────────────┐\n│ FHIRClient   │ │SMARTAuthSvc  │ │ProviderConfig│\n└──────────────┘ └──────────────┘ └──────────────┘\n```\n\n### Base Connector Features\n\nAll connectors inherit from `BaseEHRConnector` and provide:\n\n1. **OAuth2 Authentication**\n   - SMART on FHIR with PKCE\n   - Automatic token refresh\n   - Secure token storage\n\n2. **FHIR Operations**\n   - Patient data retrieval\n   - Resource queries\n   - Document download\n   - Pagination handling\n\n3. **Error Handling**\n   - Retry logic\n   - Rate limit handling\n   - Connection validation\n\n4. **Provider-Specific Customization**\n   - Custom scopes\n   - URL modifications\n   - Special parameters\n   - Resource mappings\n\n---\n\n## Usage Examples\n\n### 1. Create a Connector\n\n```typescript\nimport { ConnectorFactory } from \'@/lib/connectors/ConnectorFactory\';\nimport { EHRProvider } from \'@/lib/config/ehr-providers\';\n\n// Epic connector\nconst epicConnector = ConnectorFactory.createConnector({\n  provider: EHRProvider.EPIC,\n  clientId: \'your-epic-client-id\',\n  redirectUri: \'https://holovitals.com/ehr/callback\',\n  useSandbox: true,\n});\n\n// Cerner connector with tenant ID\nconst cernerConnector = ConnectorFactory.createConnector({\n  provider: EHRProvider.CERNER,\n  clientId: \'your-cerner-client-id\',\n  redirectUri: \'https://holovitals.com/ehr/callback\',\n  tenantId: \'your-tenant-id\',\n  useSandbox: true,\n});\n\n// Allscripts connector (requires client secret)\nconst allscriptsConnector = ConnectorFactory.createConnector({\n  provider: EHRProvider.ALLSCRIPTS,\n  clientId: \'your-allscripts-client-id\',\n  clientSecret: \'your-allscripts-client-secret\',\n  redirectUri: \'https://holovitals.com/ehr/callback\',\n  useSandbox: true,\n});\n```\n\n### 2. Generate Authorization URL\n\n```typescript\nconst result = await connector.generateAuthorizationUrl();\n\nconsole.log(\'Authorization URL:\', result.authorizationUrl);\nconsole.log(\'State:\', result.state);\nconsole.log(\'Code Verifier:\', result.codeVerifier);\n\n// Redirect user to authorization URL\nwindow.location.href = result.authorizationUrl;\n```\n\n### 3. Exchange Code for Token\n\n```typescript\n// After user authorizes and returns with code\nconst tokenResponse = await connector.getAccessToken(\n  authorizationCode,\n  codeVerifier\n);\n\nconsole.log(\'Access Token:\', tokenResponse.accessToken);\nconsole.log(\'Refresh Token:\', tokenResponse.refreshToken);\nconsole.log(\'Patient ID:\', tokenResponse.patientId);\n```\n\n### 4. Create FHIR Client and Fetch Data\n\n```typescript\nconst fhirClient = connector.createFHIRClient(tokenResponse.accessToken);\n\n// Get patient data\nconst patientData = await connector.getPatientData(\n  fhirClient,\n  tokenResponse.patientId\n);\n\nconsole.log(\'Patient:\', patientData.patient);\nconsole.log(\'Documents:\', patientData.documentReferences);\nconsole.log(\'Observations:\', patientData.observations);\nconsole.log(\'Conditions:\', patientData.conditions);\n```\n\n---\n\n## Provider Discovery\n\n### List All Providers\n\n```typescript\nimport { ProviderDiscoveryService } from \'@/lib/services/ProviderDiscoveryService\';\n\n// Get all supported providers\nconst providers = await ProviderDiscoveryService.getSupportedProviders();\n\n// Get popular providers (sorted by market share)\nconst popular = await ProviderDiscoveryService.getPopularProviders();\n\n// Search providers\nconst results = await ProviderDiscoveryService.searchProvidersByName(\'epic\');\n```\n\n### API Endpoint\n\n```http\nGET /api/ehr/providers\n\nQuery Parameters:\n- search: Search by name\n- popular: Get popular providers (sorted by market share)\n- includeSandbox: Include sandbox configurations\n- includeDisabled: Include disabled providers\n\nResponse:\n{\n  "success": true,\n  "providers": [\n    {\n      "id": "EPIC",\n      "displayName": "Epic",\n      "description": "Epic Systems - Leading EHR provider",\n      "marketShare": 31,\n      "patientPortalName": "MyChart",\n      "capabilities": { ... }\n    }\n  ],\n  "total": 6\n}\n```\n\n---\n\n## Provider-Specific Notes\n\n### Epic\n\n**Strengths:**\n- Largest market share\n- Excellent documentation\n- Robust sandbox\n- Bulk data support\n\n**Considerations:**\n- Requires \'aud\' parameter in authorization\n- Some resources require additional scopes\n\n### Cerner/Oracle Health\n\n**Strengths:**\n- Second largest market share\n- Good FHIR support\n- Multi-tenant architecture\n\n**Considerations:**\n- Requires tenant ID\n- URLs contain tenant-specific paths\n- Different endpoints per organization\n\n### Allscripts\n\n**Strengths:**\n- Good ambulatory EHR coverage\n- Solid FHIR implementation\n\n**Considerations:**\n- Requires client secret\n- Confidential client flow\n- Lower rate limits\n\n### athenahealth\n\n**Strengths:**\n- Cloud-native platform\n- Good API documentation\n\n**Considerations:**\n- Requires client secret\n- Moderate rate limits (40/min)\n\n### eClinicalWorks\n\n**Strengths:**\n- Popular in ambulatory settings\n- Good patient portal\n\n**Considerations:**\n- Requires client secret\n- API access requires approval\n- Lower rate limits (30/min)\n\n### NextGen\n\n**Strengths:**\n- Solid ambulatory EHR\n- Good FHIR support\n\n**Considerations:**\n- Requires client secret\n- Lower rate limits (30/min)\n\n---\n\n## Testing\n\n### Sandbox Testing\n\nAll 6 providers offer sandbox environments for testing:\n\n1. **Epic Sandbox**\n   - URL: https://fhir.epic.com/\n   - Test patients available\n   - Full FHIR R4 support\n\n2. **Cerner Sandbox**\n   - URL: https://fhir-ehr-code.cerner.com/\n   - Tenant ID: ec2458f2-1e24-41c8-b71b-0e701af7583d\n   - Test data available\n\n3. **Allscripts Sandbox**\n   - URL: https://fhir-sandbox.allscripts.com/\n   - Requires registration\n\n4. **athenahealth Sandbox**\n   - URL: https://api.preview.platform.athenahealth.com/\n   - Requires registration\n\n5. **eClinicalWorks Sandbox**\n   - URL: https://fhir-sandbox.eclinicalworks.com/\n   - Requires approval\n\n6. **NextGen Sandbox**\n   - URL: https://fhir.nextgen.com/nge/sandbox/\n   - Requires registration\n\n---\n\n## Rate Limiting\n\nEach provider has different rate limits:\n\n| Provider | Requests/Minute | Requests/Hour |\n|----------|----------------|---------------|\n| Epic | 60 | 1,000 |\n| Cerner | 60 | 1,000 |\n| Allscripts | 30 | 500 |\n| athenahealth | 40 | 800 |\n| eClinicalWorks | 30 | 600 |\n| NextGen | 30 | 500 |\n\n**Best Practices:**\n- Implement exponential backoff\n- Queue requests during sync\n- Monitor rate limit headers\n- Use bulk data APIs when available\n\n---\n\n## Future Providers\n\n### Planned Support\n\n1. **MEDITECH** - 3% market share\n2. **Practice Fusion** - 2% market share\n3. **Greenway Health** - 2% market share\n4. **ModMed** - 1% market share\n5. **DrChrono** - 1% market share\n\n**Total Potential Coverage: 88%**\n\n---\n\n## Support\n\nFor provider-specific questions:\n- **Epic**: https://fhir.epic.com/\n- **Cerner**: https://fhir.cerner.com/\n- **Allscripts**: https://developer.allscripts.com/\n- **athenahealth**: https://docs.athenahealth.com/\n- **eClinicalWorks**: Contact vendor\n- **NextGen**: https://developer.nextgen.com/\n\n---\n\n**Last Updated**: January 2025  \n**Version**: 1.0.0  \n**Providers Supported**: 6  \n**Market Coverage**: 79%\n</create-file>\n</function_calls>'}