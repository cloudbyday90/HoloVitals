
> medical-analysis-platform@0.1.0 test
> jest

PASS __tests__/services/LightweightChatbotService.test.ts
  ● Console

    console.error
      Chat error: Error: API Error
          at Object.<anonymous> (/workspace/medical-analysis-platform/__tests__/services/LightweightChatbotService.test.ts:349:50)
          at Promise.finally.completed (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at processTicksAndRejections (node:internal/process/task_queues:95:5)
          at _runTest (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at _runTestsForDescribeBlock (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/workspace/medical-analysis-platform/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/workspace/medical-analysis-platform/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/workspace/medical-analysis-platform/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/workspace/medical-analysis-platform/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/workspace/medical-analysis-platform/node_modules/jest-runner/build/testWorker.js:497:12)

      184 |       };
      185 |     } catch (error: any) {
    > 186 |       console.error('Chat error:', error);
          |               ^
      187 |       throw new Error(`Chat processing failed: ${error.message}`);
      188 |     }
      189 |   }

      at LightweightChatbotService.error [as chat] (lib/services/LightweightChatbotService.ts:186:15)
      at Object.<anonymous> (__tests__/services/LightweightChatbotService.test.ts:362:7)

PASS __tests__/services/ContextOptimizerService.test.ts
PASS __tests__/services/AnalysisQueueService.test.ts
PASS __tests__/services/InstanceProvisionerService.simple.test.ts (16.248 s)
FAIL __tests__/services/InstanceProvisionerService.test.ts (229.654 s)


  ● Test suite failed to run

    ReferenceError: setImmediate is not defined

      64 |     
      65 |     service.stopMonitoring();
    > 66 |     await prisma.$disconnect();
         |     ^
      67 |   });
      68 |
      69 |   describe('provisionInstance', () => {

      at node_modules/@prisma/client/src/runtime/core/engines/library/LibraryEngine.ts:469:32
      at r (node_modules/@prisma/client/src/runtime/core/engines/library/LibraryEngine.ts:469:13)
      at Object.callback [as runInChildSpan] (node_modules/@prisma/client/src/runtime/core/tracing/TracingHelper.ts:24:12)
      at Ao.runInChildSpan (node_modules/@prisma/client/src/runtime/core/tracing/TracingHelper.ts:49:42)
      at Qr.stop (node_modules/@prisma/client/src/runtime/core/engines/library/LibraryEngine.ts:495:54)
      at Proxy.$disconnect (node_modules/@prisma/client/src/runtime/getPrismaClient.ts:473:9)
      at Object.<anonymous> (__tests__/services/InstanceProvisionerService.test.ts:66:5)

Test Suites: 1 failed, 4 passed, 5 total
Tests:       89 passed, 89 total
Snapshots:   0 total
Time:        231.9 s
Ran all test suites.
