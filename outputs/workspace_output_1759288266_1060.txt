model EHRConnection {
  id                    String            @id @default(uuid())
  userId                String            @map("user_id")
  provider              EHRProvider
  providerName          String            @map("provider_name") // e.g., "Kaiser Permanente"
  fhirBaseUrl           String            @map("fhir_base_url")
  status                ConnectionStatus  @default(PENDING)
  
  // OAuth tokens (encrypted)
  accessToken           String?           @map("access_token") @db.Text
  refreshToken          String?           @map("refresh_token") @db.Text
  tokenExpiresAt        DateTime?         @map("token_expires_at")
  
  // Patient context
  patientId             String?           @map("patient_id") // FHIR Patient ID
  patientName           String?           @map("patient_name")
  
  // Sync settings
  autoSync              Boolean           @default(true) @map("auto_sync")
  syncFrequency         Int               @default(24) @map("sync_frequency") // hours
  lastSyncAt            DateTime?         @map("last_sync_at")
  nextSyncAt            DateTime?         @map("next_sync_at")
  
  // Metadata
  metadata              String?           @db.Text // JSON: additional provider-specific data
  errorMessage          String?           @db.Text @map("error_message")
  createdAt             DateTime          @default(now()) @map("created_at")
  updatedAt             DateTime          @updatedAt @map("updated_at")
  
  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  fhirResources         FHIRResource[]
  syncHistory           SyncHistory[]
  
  @@index([userId])
  @@index([status])
  @@index([provider])
  @@index([nextSyncAt])
  @@map("ehr_connections")
}

model FHIRResource {
  id                    String            @id @default(uuid())
  connectionId          String            @map("connection_id")
  resourceType          FHIRResourceType  @map("resource_type")
